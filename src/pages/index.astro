---
import About from "@/components/pages/landing/about";
import ContactForm from "@/components/pages/landing/contact-form";
import { Experience } from "@/components/pages/landing/experience";
import { Hero } from "@/components/pages/landing/hero";
import LandingFooter from "@/components/pages/landing/landing-footer.astro";
import { LandingHeader } from "@/components/pages/landing/landing-header";
import Projects from "@/components/pages/landing/projects.astro";
import { SectionHeader } from "@/components/pages/landing/section-header";
import Technologies from "@/components/pages/landing/technologies.astro";
import { getPortfolioData } from "@/data/portfolio";
import SiteLayout from "@/layout/site-layout.astro";
import { ArrowDown } from "lucide-react";

export const prerender = false;

const data = await getPortfolioData();

if (!data || !data.profile.active) {
  return Response.json({ message: "Profile is not active or not found." }, { status: 404 });
}
const { socialLinks, experience, technologies, profile, projects } = data;
---

<SiteLayout title={`${profile.name} - ${profile.title}`}>
  <div class="bg-background text-foreground relative min-h-screen font-sans">
    <LandingHeader
      client:load
      navItems={[
        { href: "#sobre-mi", label: "Sobre mi" },
        { href: "#experiencia", label: "Experiencia" },
        { href: "#tecnologias", label: "Tecnologías" },
        { href: "#proyectos", label: "Proyectos" },
        { href: "#contacto", label: "Contacto" },
      ]}
    />
    <div class="px-5 pb-16 sm:px-8 md:px-10">
      <main class="space-y-48 pt-10 md:pt-16">
        <pre></pre>
        <section class="mx-auto max-w-4xl">
          <Hero socialLinks={socialLinks} profile={profile} />
        </section>

        <div class="flex justify-center" aria-hidden>
          <ArrowDown className="text-muted-foreground h-5 w-5 animate-bounce" />
        </div>

        <section id="sobre-mi" class="mx-auto max-w-4xl">
          <SectionHeader number={1} title="Sobre mí" />

          <About profile={profile} />
        </section>

        <section id="experiencia" class="mx-auto max-w-4xl">
          <SectionHeader number={2} title="Experiencia" />

          <Experience experience={experience} />
        </section>

        <section id="tecnologias" class="mx-auto max-w-4xl">
          <SectionHeader number={3} title="Tecnologías" />

          <Technologies technologies={technologies} />
        </section>

        <section id="proyectos" class="mx-auto max-w-4xl">
          <SectionHeader number={4} title="Proyectos" />

          <Projects projects={projects} />
        </section>

        <section id="contacto" class="mx-auto max-w-prose space-y-8">
          <ContactForm client:load profileId={profile.userId} />
        </section>
      </main>
      <LandingFooter name={profile.name} socialLinks={socialLinks} />
    </div>
  </div>

  <script>
    import { setupObfuscatedLinks } from "@/lib/obfuscation";

    document.addEventListener("DOMContentLoaded", setupObfuscatedLinks);
    document.addEventListener("astro:page-load", setupObfuscatedLinks);
  </script>
</SiteLayout>
